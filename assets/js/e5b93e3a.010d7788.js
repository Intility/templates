"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2184],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,h=c["".concat(p,".").concat(m)]||c[m]||d[m]||a;return n?i.createElement(h,o(o({ref:t},u),{},{components:n})):i.createElement(h,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3263:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return d}});var i=n(3117),r=n(102),a=(n(7294),n(3905)),o=["components"],l={title:".gitlab-ci.yml Overview",sidebar_position:4},p=void 0,s={unversionedId:"configuration/gitlab-ci",id:"configuration/gitlab-ci",title:".gitlab-ci.yml Overview",description:"The gitlab-ci.yml file included with the template comes with the following jobs",source:"@site/cra/configuration/gitlab-ci.mdx",sourceDirName:"configuration",slug:"/configuration/gitlab-ci",permalink:"/cra/configuration/gitlab-ci",draft:!1,editUrl:"https://github.com/Intility/templates/tree/main/docusaurus/cra/configuration/gitlab-ci.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:".gitlab-ci.yml Overview",sidebar_position:4},sidebar:"cra",previous:{title:"Environment Variables",permalink:"/cra/configuration/environment-variables"},next:{title:"SonarQube",permalink:"/cra/configuration/sonarqube"}},u={},d=[{value:"<code>build</code>",id:"build",level:2},{value:"<code>test</code>",id:"test",level:2},{value:"<code>sonarqube</code>",id:"sonarqube",level:2},{value:"<code>image</code>",id:"image",level:2},{value:"<code>sentry</code>",id:"sentry",level:2},{value:"<code>deploy</code>",id:"deploy",level:2}],c={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"gitlab-ci.yml")," file included with the template comes with the following jobs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"build\nbuild:dev\nbuild:prod\n\ntest\n\nsonarqube\n\nimage:dev\nimage:prod\n\nsentry:dev\nsentry:prod\n\ndeploy:dev\n.deploy:prod\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This page describes jobs of the current version of the templates.\nIf you use an old version, they might differ.\nCheck out the ",(0,a.kt)("a",{parentName:"p",href:"/cra/advanced/upgrade-pipeline"},"pipeline upgrade guide")," to update to the V1 pipeline.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"All ",(0,a.kt)("inlineCode",{parentName:"p"},"*:dev")," jobs is set to run on pushes to ",(0,a.kt)("inlineCode",{parentName:"p"},"master")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," branch.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"All ",(0,a.kt)("inlineCode",{parentName:"p"},"*:prod")," jobs are set to run when tags are pushed to the repository.")),(0,a.kt)("h2",{id:"build"},(0,a.kt)("inlineCode",{parentName:"h2"},"build")),(0,a.kt)("p",null,"The main ",(0,a.kt)("inlineCode",{parentName:"p"},"build")," job runs ",(0,a.kt)("a",{parentName:"p",href:"https://create-react-app.dev/docs/available-scripts/#npm-run-build"},(0,a.kt)("inlineCode",{parentName:"a"},"npm run build"))," on every push to all branches (except master).\nIt will pass some default environment variables;"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"REACT_APP_SENTRY_DSN")," will be ",(0,a.kt)("a",{parentName:"li",href:"/cra/configuration/sentry#acquire-token"},(0,a.kt)("inlineCode",{parentName:"a"},"SENTRY_ENV"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"REACT_APP_SENTRY_ENVIRONMENT")," will be the git branch name"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"REACT_APP_SENTRY_RELEASE")," will be the git commit SHA"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"REACT_APP_REDIRECT_URI")," will be",(0,a.kt)("br",{parentName:"li"}),(0,a.kt)("inlineCode",{parentName:"li"},"https://{projectSlug}-{branchName}.openshift-inside.intility.no"))),(0,a.kt)("p",null,"It also creates an artifact of the ",(0,a.kt)("inlineCode",{parentName:"p"},"build")," folder that is created,\nwhich will be passed onto later jobs."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"build:*")," pipeline does the same as build,\nexcept it adds a GitLab environment.\nThe base job uses the GitLab environment name to configure the Sentry environment."),(0,a.kt)("h2",{id:"test"},(0,a.kt)("inlineCode",{parentName:"h2"},"test")),(0,a.kt)("p",null,"This job simply runs the ",(0,a.kt)("a",{parentName:"p",href:"https://create-react-app.dev/docs/available-scripts/#npm-test"},(0,a.kt)("inlineCode",{parentName:"a"},"npm test"))," script."),(0,a.kt)("h2",{id:"sonarqube"},(0,a.kt)("inlineCode",{parentName:"h2"},"sonarqube")),(0,a.kt)("p",null,"This job uses the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/"},"SonarScanner CLI")," to upload the source code to SonarQube.\nThe pipeline will continue if this job fails, but it should be looked into."),(0,a.kt)("h2",{id:"image"},(0,a.kt)("inlineCode",{parentName:"h2"},"image")),(0,a.kt)("p",null,"The image jobs builds a docker image with the ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile.CI")," dockerfile,\nand with the build output from the ",(0,a.kt)("inlineCode",{parentName:"p"},"build")," jobs."),(0,a.kt)("p",null,"For the ",(0,a.kt)("inlineCode",{parentName:"p"},"image:dev")," job, it pushes two tags, one with ",(0,a.kt)("inlineCode",{parentName:"p"},"dev"),", and one with the pipeline id.\nFor the ",(0,a.kt)("inlineCode",{parentName:"p"},"image:prod")," job, the tags pushed are ",(0,a.kt)("inlineCode",{parentName:"p"},"latest")," and the tag name."),(0,a.kt)("h2",{id:"sentry"},(0,a.kt)("inlineCode",{parentName:"h2"},"sentry")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"sentry")," job uses the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.sentry.io/product/cli/"},"Sentry CLI")," to create a new release.\nThe release name will be the git commit SHA.\nIt will connect the release to the current commit, and upload sourcemaps from the build step.\nLastly it will associate the release with the right env."),(0,a.kt)("h2",{id:"deploy"},(0,a.kt)("inlineCode",{parentName:"h2"},"deploy")),(0,a.kt)("p",null,"This is the main job for deploying to OpenShift.",(0,a.kt)("br",{parentName:"p"}),"\n","It will create an environment in GitLab, with the URL to the running app."),(0,a.kt)("p",null,"It uses Helm to install the app to an OpenShift project."),(0,a.kt)("p",null,"For ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy:dev"),", the route defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"https://{projectSlug}-dev.apps.int.intility.no"),".",(0,a.kt)("br",{parentName:"p"}),"\n","For ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy:prod"),", the route defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"https://{projectSlug}.apps.int.intility.no"),"."))}m.isMDXComponent=!0}}]);